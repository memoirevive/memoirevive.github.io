<html>
<head>
	<title>Cher député</title>
	
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="main.css">
	<script src="deputes.js"></script>
</head>

<body>
	<h1>Cher député</h1>
	<div class="arrow">↓</div>
	<div id="email-container">
		<div id="email">
			<input type="text" id="subject">
			<textarea id="body"></textarea>
		<input type="button" class="submit" value="Choisir mon député" onclick="scrolltoMPs()">
		</div>
	</div>
	<div class="arrow">↓</div>
	<input type="text" placeholder="Rechercher..." id="search">
	<div id="MPs-container">
		<div id="MPs"></div>
	</div>
	<div class="arrow">↓</div>
	<div id="end-container">
		<div id="end">
			<h1>Prêt à envoyer</h1>
			<div id="details-container">
				<img id="photo2" src=""> 
				<div id="details"></div>
			</div>
			<img id="gmail" src="img/gmail.png" width="100" onclick="send()">
		</div>
	</div>
<script>
let finalMP = null;
const MPsDiv = document.querySelector("#MPs");
setHTML(search="");

const inputSubject = document.querySelector("#subject");
const textareaBody = document.querySelector("#body");
const inputSearch = document.querySelector("#search");
const end = document.querySelector("#end");
const details = document.querySelector("#details");
const photo2 = document.querySelector("#photo2");

inputSubject.value = "Message d'un citoyen";

textareaBody.value = "Bonjour,\n\nPourquoi ne pas soutenir un investissement massif dans le train, alors que c'est la meilleure alternative pour se passer de la voiture ?\n\nMerci d'avance de votre réponse.\n\nCordialement,\n\nUn citoyen";

inputSearch.addEventListener('keyup', () => { 
	setHTML(inputSearch.value);
});

function scrolltoMPs() {
    window.scrollTo(0, document.getElementById("search").offsetTop);
}

function scrolltoEnd() {
    window.scrollTo(0, document.getElementById("end").offsetTop);
}

function setHTML(search) {
	let html = '';
	let key = -1;
	for (let MP of MPs) {
	key = key + 1;
		if (search !== "") {
			let words = search.split(' ');
			findings = [];
			for (let word of words) {
				if (word.length == 0) {
					continue;
				}
				if (MP[0].toLowerCase().includes(word.toLowerCase()) || MP[1].toLowerCase().includes(word.toLowerCase())) {
					findings.push(true);
				} else {
 					findings.push(false);
				}
			}
			keep = true;
			for (let finding of findings) {
				if (!finding) {
					keep = false;
				}
			}
			if (!keep) {
			  continue;
			}
		}
		html += '<div class="depute"><a href="javascript:void(0)" onclick="choose('+key+')">';
		if (MP[0] == "K/Bidi") {
			html += '<img class="photo" src="pic/optimised/K Bidi.jpg">';
		} else {
			html += '<img class="photo" src="pic/optimised/' + MP[4] + '.jpg">';
		}
		html += '</a></div>';
	}
MPsDiv.innerHTML = html;
}

function choose(MPkey) {
	finalMP = MPs[MPkey];
	
	if (finalMP[0] == "K/Bidi") {
		photo2.src = 'pic/optimised/K Bidi.jpg';
	} else {
		photo2.src = 'pic/optimised/' + finalMP[4] + '.jpg';
	}
	
	details.innerHTML= "L'icône ci-dessous ouvrira automatiquement votre boîte Gmail, avec un mail prêt à envoyer à  <b>" +finalMP[1] + "&nbsp;" + finalMP[0] + "</b> !";
	end.style.display="block";
	scrolltoEnd();
}

function send() {
	let subject = inputSubject.value;
	let body = textareaBody.value.replaceAll('\n', '%0A');
	window.location = "https://mail.google.com/mail/?view=cm&fs=1&to="+finalMP[2]+"&su="+subject+"&body="+body;
};
</script>
</body>
</html>
